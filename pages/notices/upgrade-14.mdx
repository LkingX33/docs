---
title: Upgrade 14 MT-Cannon and Isthmus L1 Contracts
description: Learn how to prepare for Upgrade 14 breaking changes.
lang: en-US
content_type: notice
topic: upgrade-14
personas:
  - chain-operator
  - node-operator
categories:
  - security
  - protocol
  - infrastructure
  - l1-contracts
is_imported_content: 'false'
---

import { Steps, Callout } from 'nextra/components'

# Upgrade 14: MT-Cannon and Isthmus L1 Contracts

<Callout type="info">
  Upgrade execution timelines are being publicly tracked in this [release management project board](https://github.com/orgs/ethereum-optimism/projects/117/views/12). 
  
  * OP Sepolia, Ink Sepolia, and Minato Sepolia upgrades have already been executed.
  * OP Mainnet, Soneium Mainnet, Ink Mainnet are expected to execute Upgrade 14 on **April 25th, 2025**.
  * Base Mainnet is executing its upgrade on **April 25th, 2025**.
  * Unichain Mainnet is executing its upgrade on **April 25th, 2025**.
  * Other Optimism governed chains' upgrades will be tracked in the release management project board.
</Callout>

This page outlines changes related to the Upgrade 14 network upgrade for chain operators, node operators, and users of OP Stack chains. The upgrade proposal is available [here](https://gov.optimism.io/t/upgrade-proposal-14-mt-cannon-and-isthmus-l1-contracts/10123) and the governance vote is available [here](https://vote.optimism.io/).

If you experience difficulty at any stage of this process, please reach out to developer support.

## What's included in Upgrade 14

Upgrade 14 contains four main components:

* **MT-Cannon**: An upgrade to the fault proof VM that supports the MIPS-64 instruction set and multi-threaded programs, removing memory constraints for the fault proof program.
* **L2 Withdrawals Root in Block Header**: A change making it easier for chain operators to guarantee the security of fault proofs for chains in the Superchain as the number of chains scales.
* **Operator Fee**: Introduction of the first phase of a mechanism addressing challenges in accurately pricing user fees when chains employ ZK proving, alt-DA, and custom gas tokens.
* **L2 Pectra Support**: Support for Ethereum's Pectra hard fork features including BLS12-381 precompiles, historical block hashes on-chain, and set-code transactions (EIP-7702).

## Technical details

### MT-Cannon

MT-Cannon is an upgrade to [Cannon](/stack/fault-proofs/cannon), the [fault proof VM](/stack/fault-proofs/fp-components#fault-proof-virtual-machine) that supports the MIPS-64 instruction set and multi-threaded programs, removing memory constraints for the fault proof program.

Key changes:

* The emulated CPU architecture is now MIPS64 instead of MIPS32
  * Registers now hold 64-bit values
  * Memory address space is dramatically expanded
  * New 64-bit specific instructions added for operations on 64-bit values
* Supports reading 8 bytes of data at a time from the pre-image oracle instead of 4
* Multithreading support
  * Concurrency via multitasking 
  * VM now tracks ThreadState objects for each thread
  * Thread-safe memory access enabled by Load Linked Word (ll) and Store Conditional Word (sc) instructions
  * Extended syscall support for multi-threading
* Improved exception handling for unrecognized syscalls

After this upgrade, the on-chain implementation of the fault proof VM will be [MIPS64.sol](https://github.com/ethereum-optimism/optimism/blob/develop/packages/contracts-bedrock/src/cannon/MIPS64.sol) instead of [MIPS.sol](https://github.com/ethereum-optimism/optimism/blob/develop/packages/contracts-bedrock/src/cannon/MIPS.sol).

### L2 Withdrawals Root in Block Header

This component makes changes to:

* Add the storage root of the `L2ToL1MessagePasser` contract to the `ExecutionPayload`
* Add a new p2p gossip topic (`v4`) for Isthmus blocks
* Update the SSZ encoding & gossip to account for withdrawalsRoot
* Use the Isthmus timestamp activations

These changes make it easier for chain operators to guarantee the security of fault proofs as the Superchain scales.

### Operator Fee

This introduces two new rollup operator configured scalars:

* `operatorFeeScalar`
* `operatorFeeConstant`

These parameters are factored into the fee calculation as follows:

```
operatorFee = operatorFeeConstant + operatorFeeScalar * gasUsed / 1e6

totalFee = operatorFee + gasUsed * (baseFee + priorityFee) + l1Fee
```

The scalars will be updated via the SystemConfig L1 contract. A new fee vault, the OperatorFeeVault, will store the operator fee. While this feature is included in the upgrade, it is disabled by default and will be enabled in a future hardfork.

### L2 Pectra Support

This component prepares for Ethereum's Pectra upgrade by including support for several EIPs:

* **EIP-7702**: Set code transaction
  * Added authorization list to span batch format
* **EIP-2537**: BLS12-381 precompiles
  * Added input limits and specified acceleration
* **EIP-2935**: Block hashes contract predeploy
  * Added network upgrade transaction
* **EIP-7251**: Increase the MAX_EFFECTIVE_BALANCE
  * Only affects execution clients
* **EIP-7623**: Increase calldata cost
  * Only affects execution clients
* **EIP-7002**: Execution layer triggerable withdrawals
  * Not applicable to OP Stack
* **EIP-6110**: Supply validator deposits on chain
  * Not applicable to OP Stack
* **EIP-7685**: General purpose execution layer requests
  * No requests currently applicable to OP Stack

### Absolute Prestate

Beginning with this upgrade, op-program absolute prestates will now use the "cannon64" variant. This upgrade includes [the absolute prestate for op-program 1.5.1-rc.1, which is `0x03ee2917da962ec266b091f4b62121dc9682bb0db534633707325339f99ee405`](https://github.com/ethereum-optimism/superchain-registry/blob/main/validation/standard/standard-prestates.toml).

## For chain operators

If this proposal is accepted, multisig ceremonies will be coordinated to execute upgrade transactions. The following transactions will be executed on the respective chains: `OP Mainnet`, `Soneium Mainnet`, `Ink Mainnet`, `Base Mainnet`, and `Unichain Mainnet`. If your Optimism governed chain is not in this list, please reach out to OP Labs Solutions Engineering to coordinate your upgrade.

For chain operators running fault-proof infrastructure, ensure you are running up-to-date versions of the following:

* op-challenger: `op-challenger/v1.3.3` (preferred) or at least `op-challenger/v1.3.1`
* op-dispute-mon: `op-dispute-mon/v1.4.0`

## For node operators

Node operators should ensure they are running an up-to-date version of op-node that can handle new events emitted from the `SystemConfig` contract:

* op-node: `op-node/v1.12.2`

## For bridges and users

<Callout type="warning">
  All withdrawals that are not finalized before the upgrade executes will need to be reproven after the upgrade is complete. You may want to consider waiting until after the upgrade is complete to begin a withdrawal during this 7-day window.
</Callout>

## Audit reports

The code for Upgrade 14 has undergone multiple audits:

* **Spearbit**: Completed an audit of MT-Cannon. Details available [here](#).
* **Coinbase Protocol Security**: Completed an audit of MT-Cannon. Details available [here](#).

## Emergency cancellation

If a critical security issue is discovered before upgrading, OP Labs will collaborate with the community to extensively communicate that the upgrade will no longer occur. The Optimism Foundation and Security Council will work to coordinate an emergency cancellation.

For more detailed information, please refer to the full upgrade proposal or reach out to developer support.